<div class="header">
  <img src="assets/logo.png" alt="Richbond Logo" class="logo" />
  <div class="header-icons">
    <mat-icon>notifications_none</mat-icon>
    
    <!-- Bouton de changement de langue -->
    <button mat-button [matMenuTriggerFor]="languageMenu" class="lang-button">
      <img [src]="'assets/' + (currentLanguage === 'fr' ? 'OIP.webp' : 'usa.png')" 
           alt="Language" 
           class="lang-icon" />
      <span>{{ currentLanguage | uppercase }}</span>
      <mat-icon>arrow_drop_down</mat-icon>
    </button>
    
    <mat-menu #languageMenu="matMenu">
      <button mat-menu-item (click)="changeLanguage('fr')">
        <img src="assets/OIP.webp" alt="Français" class="lang-option-icon">
        <span>FR</span>
      </button>
      <button mat-menu-item (click)="changeLanguage('en')">
        <img src="assets/usa.png" alt="English" class="lang-option-icon">
        <span>EN</span>
      </button>
    </mat-menu>
    
    <mat-icon>settings</mat-icon>
  </div>
</div>

<div class="container">
  <div class="example-container">
    <!-- ✅ SIDEBAR NAVIGATION -->
    <div class="sidebar" [class.sidebar-collapsed]="!menuOpen">
      <div class="user-profile" [class.user-profile-collapsed]="!menuOpen">
        <img 
          [src]="avatarUrl" 
          alt="Avatar" 
          width="100" 
          height="100" 
          style="border-radius:50%;" />
        <div class="user-info" [class.user-info-hidden]="!menuOpen">
          <strong>{{ username }}</strong>
          <p>{{ role }}</p>
        </div>
      </div>

      <mat-nav-list [class.nav-list-collapsed]="!menuOpen">
        <a mat-list-item routerLink="/Dashbord" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen" 
           [matTooltip]="!menuOpen ? ('COMMON.DASHBOARD' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>dashboard</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.DASHBOARD' | translate }}</span>
        </a>
        
        <a mat-list-item routerLink="/users" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? 'Tous les utilisateurs' : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>group</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">Tous les utilisateurs</span>
        </a>
        
        <a mat-list-item routerLink="/merchendiseur" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.MERCHANDISERS' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>storefront</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.MERCHANDISERS' | translate }}</span>
        </a>
        
        <a mat-list-item routerLink="/superviseur" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.SUPERVISORS' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>supervisor_account</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.SUPERVISORS' | translate }}</span>
        </a>
        
        <a mat-list-item routerLink="/magasins" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.STORES' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>store</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.STORES' | translate }}</span>
        </a>
        
        <a mat-list-item routerLink="/planification" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.PLANNING' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>event_note</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.PLANNING' | translate }}</span>
        </a>
        
        <a mat-list-item routerLink="/gestion-visites" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.VISIT' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>location_on</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.VISIT' | translate}}</span>
        </a>

        <a mat-list-item routerLink="/Produit" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.PRODUCTS' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>inventory</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.PRODUCTS' | translate }}</span>
        </a>
        
        <a mat-list-item routerLink="/parametre" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.SETTINGS' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>settings</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.SETTINGS' | translate }}</span>
        </a>

        <a mat-list-item routerLink="/help" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.HELP' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>help_outline</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.HELP' | translate }}</span>
        </a>
        
        <a mat-list-item (click)="openLogoutDialog()" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('AUTH.LOGOUT' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon style="color: #ff0022;">logout</mat-icon>
          <span matListItemTitle style="color: #ff0022;" [class.text-hidden]="!menuOpen">{{ 'AUTH.LOGOUT' | translate }}</span>
        </a>
      </mat-nav-list>
    </div>

    <div class="content">
      <div class="page-header">
        <div class="page-header-left">
          <button mat-icon-button (click)="toggleMenu()" class="menu-toggle">
            <mat-icon *ngIf="!menuOpen" style="color: #333;margin-bottom: 15px;">keyboard_arrow_left</mat-icon>
            <mat-icon *ngIf="menuOpen" style="color: #333;margin-bottom: 15px;">keyboard_arrow_right</mat-icon>
          </button>
          <h1 (click)="goBack()" style="cursor: pointer;">{{ 'COMMON.MERCHANDISERS' | translate }}</h1>
        </div>
      </div>

     
        <!-- Loading Spinner -->


        <!-- Merchandiseur Details -->
        <!-- Contenu principal -->
      <div class="all" style="background:white">
                <div *ngIf="loading" class="loading-container">
          <mat-spinner diameter="50"></mat-spinner>
          <p>Chargement des données...</p>
        </div>

        <!-- Error Message -->
        <div *ngIf="error && !loading" class="error-container">
          <mat-icon class="error-icon">error_outline</mat-icon>
          <h3>Erreur</h3>
          <p>{{ error }}</p>
          <button mat-raised-button color="primary" (click)="goBack()">
            Retour à la liste
          </button>
        </div>
        <!-- Superviseur details -->
        <div *ngIf="merchendiseur && !loading" class="superviseur-detail-container" style="background:white">
          <!-- Carte de détail du superviseur -->
          <div class="superviseur-detail-card" style="background:white;margin-bottom:30%">
            <!-- Header du superviseur -->
            <div class="superviseur-header">
               <div class="profile-header">
                <div class="profile-picture-section">
                  <div class="profile-picture-container">
                  <img [src]="getMerchendiseurImageUrl()" 
                       *ngIf="merchendiseur.imagePath; else noImage"
                       class="profile-picture"
                       (error)="onImageError($event)">
                  <ng-template #noImage>
                    <div class="no-image-placeholder">
                      <mat-icon>person</mat-icon>
                    </div>
                  </ng-template>
                </div>
              </div>
              
              <div class="profile-info">
                <h1 class="profile-name">{{ merchendiseur.nom }} {{ merchendiseur.prenom }}</h1>
                <p class="profile-email">{{ merchendiseur.email || 'Email non spécifié' }}</p>
              </div>
            </div>
            
            <div class="footer-actions">
                <button mat-raised-button class="export-button" (click)="goBack()" > 
      <span>Retour</span>
      <mat-icon>arrow_back</mat-icon>
    </button>
              <button
                mat-raised-button
                class="add-user-button"
                style="background-color: #0A2681; color: white;"
                (click)="editMerchendiseur()"
                *ngIf="merchendiseur"
              >
                Modifier le merchandiseur
              </button>
            </div>
          </div>

            <!-- Contenu du merchandiseur -->
            <div class="superviseur-content" style="background:white">
              <!-- Section Profile Header -->
            

              <!-- Section Informations -->
              <div class="info-section">
                <div class="info-grid">
                  <div class="info-row">
                    <div class="info-field">
                      <label class="field-label">Nom complet</label>
                      <div class="field-value">{{ merchendiseur.nom }} {{ merchendiseur.prenom }}</div>
                    </div>
                    
                    <div class="info-field">
                      <label class="field-label">Téléphone</label>
                      <div class="field-value">{{ merchendiseur.telephone || 'Non spécifié' }}</div>
                    </div>
                  </div>

                  <div class="info-row">
                    <div class="info-field">
                      <label class="field-label">Région</label>
                      <div class="field-value">{{ merchendiseur.region || 'Non spécifiée' }}</div>
                    </div>
                    
                    <div class="info-field">
                      <label class="field-label">Ville</label>
                      <div class="field-value">{{ merchendiseur.ville || 'Non spécifiée' }}</div>
                    </div>
                  </div>

                  <div class="info-row">
                    <div class="info-field">
                      <label class="field-label">Localisation</label>
                      <div class="field-value">{{ merchendiseur.localisation || 'Non spécifiée' }}</div>
                    </div>
                    
                    <div class="info-field">
                      <label class="field-label">Rôle</label>
                      <div class="field-value">{{ merchendiseur.role || 'Non spécifié' }}</div>
                    </div>
                  </div>

                  <div class="info-row">
                    <div class="info-field">
                      <label class="field-label">Marques Couvertes</label>
                      <div class="field-value">{{ merchendiseur.marqueCouverte || 'Non spécifiées' }}</div>
                    </div>
                    
                    <div class="info-field">
                      <label class="field-label">Enseignes</label>
                      <div class="field-value">{{ merchendiseur.enseignes.join(', ') || 'Non spécifiées' }}</div>
                    </div>
                  </div>

                  <div class="info-row">
                    <div class="info-field">
                      <label class="field-label">Date d'Intégration</label>
                      <div class="field-value">{{ merchendiseur.dateDebutIntegration | date:'dd/MM/yyyy' || 'Non spécifiée' }}</div>
                    </div>
                    
                    <div class="info-field">
                      <label class="field-label">Date de Sortie</label>
                      <div class="field-value">{{ merchendiseur.dateSortie | date:'dd/MM/yyyy' || 'Non spécifiée' }}</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Section Magasins -->
              <div class="merchandiseurs-section" *ngIf="magasins && magasins.length > 0">
                <div class="section-title">
                  <mat-icon class="section-icon">store</mat-icon>
                  <span>Magasins Assignés ({{ magasins.length }})</span>
                </div>
                
                <div class="merchandiseurs-grid">
                  <div class="merchandiseur-card" *ngFor="let magasin of magasins">
                    <div class="merchandiseur-header">
                      <div class="merchandiseur-avatar">
                        <div class="no-merch-image-placeholder">
                          <mat-icon>store</mat-icon>
                        </div>
                      </div>
                      
                      <div class="merchandiseur-info">
                        <h3 class="merchandiseur-name">{{ magasin.nom }}</h3>
                        <p class="merchandiseur-email">{{ magasin.enseigne || 'Enseigne non spécifiée' }}</p>
                      
                      </div>
                    </div>
                    
                    <div class="merchandiseur-details">
                      <div class="detail-row full-width">
                        <div class="detail-field full-width">
                          <label class="detail-label ">Localisation</label>
                          <div class="detail-value full-width">{{ magasin.localisation || 'Non spécifiée' }}</div>
                        </div>
                        
                      </div>
                      
                      <div class="detail-row">
                        <div class="detail-field full-width">
                          <label class="detail-label">Région</label>
                          <div class="detail-value">{{ magasin.region || 'Non spécifiée' }}</div>
                        </div>
                      </div>
                        <div class="detail-row full-width">
                       <div class="detail-field  full-width">
                          <label class="detail-label">Ville</label>
                          <div class="detail-value">{{ magasin.ville || 'Non spécifiée' }}</div>
                        </div>
                      </div>
                    
                    </div>
                  </div>
                </div>
              </div>

              <!-- Message si aucun magasin -->
              <div class="no-merchandiseurs" *ngIf="!magasins || magasins.length === 0">
                <div class="no-merchandiseurs-content">
                  <mat-icon class="no-merchandiseurs-icon">store_off</mat-icon>
                  <h3>Aucun magasin assigné</h3>
                  <p>Ce merchandiseur n'a actuellement aucun magasin sous sa responsabilité.</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- États de chargement et d'erreur -->
        <div *ngIf="loading" class="loading-container">
          <mat-spinner></mat-spinner>
          <p>Chargement des détails du merchandiseur...</p>
        </div>

        <div *ngIf="error" class="error-container">
          <mat-icon class="error-icon">error</mat-icon>
          <h3>Erreur</h3>
          <p>{{ error }}</p>
          <button mat-raised-button color="primary" (click)="goBack()">
            Retour à la liste
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
