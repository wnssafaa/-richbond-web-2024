<div class="header">
  <img src="assets/logo.png" alt="Richbond Logo" class="logo" />
  <div class="header-icons">
    <mat-icon>notifications_none</mat-icon>

    <!-- Bouton de changement de langue -->
    <button mat-button [matMenuTriggerFor]="languageMenu" class="lang-button">
      <img
        [src]="'assets/' + (currentLanguage === 'fr' ? 'OIP.webp' : 'usa.png')"
        alt="Language"
        class="lang-icon"
      />
      <span>{{ currentLanguage | uppercase }}</span>
      <mat-icon>arrow_drop_down</mat-icon>
    </button>

    <mat-menu #languageMenu="matMenu">
      <button mat-menu-item (click)="changeLanguage('fr')">
        <img src="assets/OIP.webp" alt="Français" class="lang-option-icon" />
        <span>FR</span>
      </button>
      <button mat-menu-item (click)="changeLanguage('en')">
        <img src="assets/usa.png" alt="English" class="lang-option-icon" />
        <span>EN</span>
      </button>
    </mat-menu>

    <mat-icon>settings</mat-icon>
  </div>
</div>
<div class="container">
  <div class="example-container">
    <!-- ✅ SIDEBAR NAVIGATION -->
    <div class="sidebar" [class.sidebar-collapsed]="!menuOpen">
      <div class="user-profile" [class.user-profile-collapsed]="!menuOpen">
        <!-- Image dynamique : avatarUrl ou imagePath -->
        <img
          [src]="avatarUrl"
          alt="Avatar"
          width="100"
          height="100"
          style="border-radius: 50%"
        />
        <div class="user-info" [class.user-info-hidden]="!menuOpen">
          <strong>{{ username }}</strong>
          <p>{{ role }}</p>

          <!-- Logo de l'entreprise dans la section utilisateur -->
        </div>
      </div>

      <mat-nav-list [class.nav-list-collapsed]="!menuOpen">
        <a
          mat-list-item
          routerLink="/Dashbord"
          routerLinkActive="active-link"
          [class.nav-item-collapsed]="!menuOpen"
          [matTooltip]="!menuOpen ? ('COMMON.DASHBOARD' | translate) : ''"
          matTooltipPosition="right"
        >
          <mat-icon matListItemIcon>dashboard</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{
            "COMMON.DASHBOARD" | translate
          }}</span>
        </a>
        <a
          mat-list-item
          routerLink="/login-history"
          routerLinkActive="active-link"
          [class.nav-item-collapsed]="!menuOpen"
          [matTooltip]="!menuOpen ? ('LOGIN_HISTORY.TITLE' | translate) : ''"
          matTooltipPosition="right"
        >
          <mat-icon matListItemIcon>history</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{
            "LOGIN_HISTORY.TITLE" | translate
          }}</span>
        </a>

        <!-- <a mat-list-item (click)="userMenuOpen = !userMenuOpen" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.USERS' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>people</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.USERS' | translate }}</span>
          <mat-icon style="margin-left:auto;" [class.text-hidden]="!menuOpen">{{ userMenuOpen ? 'expand_less' : 'expand_more' }}</mat-icon>
        </a> -->

        <a
          mat-list-item
          routerLink="/users"
          routerLinkActive="active-link"
          [class.nav-item-collapsed]="!menuOpen"
          [matTooltip]="!menuOpen ? 'Tous les utilisateurs' : ''"
          matTooltipPosition="right"
        >
          <mat-icon matListItemIcon>group</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen"
            >Tous les utilisateurs</span
          >
        </a>

        <a
          mat-list-item
          routerLink="/merchendiseur"
          routerLinkActive="active-link"
          [class.nav-item-collapsed]="!menuOpen"
          [matTooltip]="!menuOpen ? ('COMMON.MERCHANDISERS' | translate) : ''"
          matTooltipPosition="right"
        >
          <mat-icon matListItemIcon>storefront</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{
            "COMMON.MERCHANDISERS" | translate
          }}</span>
        </a>

        <a
          mat-list-item
          routerLink="/superviseur"
          routerLinkActive="active-link"
          [class.nav-item-collapsed]="!menuOpen"
          [matTooltip]="!menuOpen ? ('COMMON.SUPERVISORS' | translate) : ''"
          matTooltipPosition="right"
        >
          <mat-icon matListItemIcon>supervisor_account</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{
            "COMMON.SUPERVISORS" | translate
          }}</span>
        </a>

        <a
          mat-list-item
          routerLink="/magasins"
          routerLinkActive="active-link"
          [class.nav-item-collapsed]="!menuOpen"
          [matTooltip]="!menuOpen ? ('COMMON.STORES' | translate) : ''"
          matTooltipPosition="right"
        >
          <mat-icon matListItemIcon>store</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{
            "COMMON.STORES" | translate
          }}</span>
        </a>

        <a
          mat-list-item
          routerLink="/planification"
          routerLinkActive="active-link"
          [class.nav-item-collapsed]="!menuOpen"
          [matTooltip]="!menuOpen ? ('COMMON.PLANNING' | translate) : ''"
          matTooltipPosition="right"
        >
          <mat-icon matListItemIcon>event_note</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{
            "COMMON.PLANNING" | translate
          }}</span>
        </a>

        <a
          mat-list-item
          routerLink="/gestion-visites"
          routerLinkActive="active-link"
          [class.nav-item-collapsed]="!menuOpen"
          [matTooltip]="!menuOpen ? ('COMMON.VISIT' | translate) : ''"
          matTooltipPosition="right"
        >
          <mat-icon matListItemIcon>location_on</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{
            "COMMON.VISIT" | translate
          }}</span>
        </a>

        <a
          mat-list-item
          routerLink="/Produit"
          routerLinkActive="active-link"
          [class.nav-item-collapsed]="!menuOpen"
          [matTooltip]="!menuOpen ? ('COMMON.PRODUCTS' | translate) : ''"
          matTooltipPosition="right"
        >
          <mat-icon matListItemIcon>inventory</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{
            "COMMON.PRODUCTS" | translate
          }}</span>
        </a>

        <a
          mat-list-item
          routerLink="/gestion-stock"
          routerLinkActive="active-link"
          [class.nav-item-collapsed]="!menuOpen"
          [matTooltip]="!menuOpen ? 'Gestion de Stock' : ''"
          matTooltipPosition="right"
        >
          <mat-icon matListItemIcon>warehouse</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">Gestion de Stock</span>
        </a>

        <a
          mat-list-item
          routerLink="/parametre"
          routerLinkActive="active-link"
          [class.nav-item-collapsed]="!menuOpen"
          [matTooltip]="!menuOpen ? ('COMMON.SETTINGS' | translate) : ''"
          matTooltipPosition="right"
        >
          <mat-icon matListItemIcon>settings</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{
            "COMMON.SETTINGS" | translate
          }}</span>
        </a>

        <a
          mat-list-item
          routerLink="/help"
          routerLinkActive="active-link"
          [class.nav-item-collapsed]="!menuOpen"
          [matTooltip]="!menuOpen ? ('COMMON.HELP' | translate) : ''"
          matTooltipPosition="right"
        >
          <mat-icon matListItemIcon>help_outline</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{
            "COMMON.HELP" | translate
          }}</span>
        </a>
        <a
          mat-list-item
          (click)="openLogoutDialog()"
          [class.nav-item-collapsed]="!menuOpen"
          [matTooltip]="!menuOpen ? ('AUTH.LOGOUT' | translate) : ''"
          matTooltipPosition="right"
        >
          <mat-icon matListItemIcon style="color: #ff0022">logout</mat-icon>
          <span
            matListItemTitle
            style="color: #ff0022"
            [class.text-hidden]="!menuOpen"
            >{{ "AUTH.LOGOUT" | translate }}</span
          >
        </a>
      </mat-nav-list>
    </div>
    <div class="content">
      <div class="page-header">
        <div class="page-header-left">
          <button mat-icon-button (click)="toggleMenu()" class="menu-toggle">
            <mat-icon *ngIf="!menuOpen" style="color: #333; margin-bottom: 15px"
              >keyboard_arrow_left</mat-icon
            >
            <mat-icon *ngIf="menuOpen" style="color: #333; margin-bottom: 15px"
              >keyboard_arrow_right</mat-icon
            >
          </button>
          <h1>{{ "USERS.TITLE" | translate }}</h1>
        </div>
      </div>

      <div class="all">
        <!-- Ligne du haut : Barre principale avec actions (toujours visible) -->
        <div class="main-toolbar">
          <div class="main-toolbar-content">
            <!-- Section gauche : Recherche et Filtre -->
            <div class="left-controls">
              <div class="custom-search-box">
                <input
                  type="text"
                  [placeholder]="'ACTIONS.SEARCH' | translate"
                  [(ngModel)]="searchTerm"
                  (keyup)="applyFilter()"
                />
                <button>
                  <span class="material-icons" style="font-weight: bold"
                    >search</span
                  >
                </button>
              </div>

              <button
                mat-stroked-button
                class="filter-button-custom"
                (click)="showFilters = !showFilters"
              >
                <mat-icon style="color: #8192a6; font-size: 18px"
                  >filter_list</mat-icon
                >
                <span style="color: #8192a6">{{
                  "ACTIONS.FILTER" | translate
                }}</span>
              </button>
            </div>

            <!-- Section droite : Boutons d'action -->
            <div class="right-controls">
              <button
                mat-raised-button
                class="export-button"
                (click)="exportToExcel()"
                style="background-color: #000000; color: white; margin-right: 8px"
              >
                <span>{{ "ACTIONS.EXPORT" | translate }}</span>
                <mat-icon>file_download</mat-icon>
              </button>

              <button
                mat-raised-button
                class="export-button"
                (click)="openColumnCustomizationPanel()"
                style="background-color: #3b45ca; color: white; margin-right: 8px"
                matTooltip="Personnaliser les colonnes"
              >
                <span>Organiser</span>
                <mat-icon style="color:white">view_column</mat-icon>
              </button>

              <!-- Bouton d'importation -->
              <button
                *ngIf="canAdd"
                mat-raised-button
                class="import-button"
                style="background-color: #455e98; color: white; margin-right: 12px; padding: 10px 15px; border-radius: 20px;"
                (click)="openImportDialog()"
              >
                <mat-icon style="color:white">upload_file</mat-icon>
                Importer
              </button>

              <button
                *ngIf="canAdd"
                mat-raised-button
                class="add-user-button"
                style="background-color: #0a2681; color: white"
                (click)="openAddUserDialog()"
              >
               Ajouter

              </button>
            </div>
          </div>
        </div>

        <!-- Ligne du bas : Filtres avancés (affichés seulement si showFilters = true) -->
        <div *ngIf="showFilters" class="filters-toolbar">
          <!-- Première ligne : 3 filtres -->
          <div class="filters-content filters-row-1">
            <mat-form-field appearance="outline">
              <mat-label>{{ "USERS.ROLE" | translate }}</mat-label>
              <mat-select
                [(ngModel)]="selectedRole"
                (selectionChange)="applyFilter()"
              >
                <mat-option value="">{{ "USERS.ALL_ROLES" | translate }}</mat-option>
                <mat-option value="SUPERVISEUR">SUPERVISEUR</mat-option>
                <mat-option value="MERCHENDISEUR">MERCHENDISEUR</mat-option>
                <mat-option value="ANIMATEUR">ANIMATEUR</mat-option>
              </mat-select>
              <button
                mat-icon-button
                matSuffix
                (click)="selectedRole = ''; applyFilter()"
                class="clear-filter-btn"
                tabindex="-1"
                aria-label="Effacer le filtre rôle"
                *ngIf="selectedRole"
              >
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ "USERS.STATUS" | translate }}</mat-label>
              <mat-select
                [(ngModel)]="selectedStatus"
                (selectionChange)="applyFilter()"
              >
                <mat-option value="">Tous les statuts</mat-option>
                <mat-option value="ACTIVE">ACTIVE</mat-option>
                <mat-option value="INACTIVE">INACTIVE</mat-option>
              </mat-select>
              <button
                mat-icon-button
                matSuffix
                (click)="selectedStatus = ''; applyFilter()"
                class="clear-filter-btn"
                tabindex="-1"
                aria-label="Effacer le filtre statut"
                *ngIf="selectedStatus"
              >
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ "USERS.REGION" | translate }}</mat-label>
              <mat-select
                [(ngModel)]="selectedRegion"
                (selectionChange)="onRegionChange()"
              >
                <mat-option value="">{{ "USERS.ALL_REGIONS" | translate }}</mat-option>
                <mat-option *ngFor="let region of availableRegions" [value]="region">
                  {{ ('USERS.REGIONS.' + region) | translate }}
                </mat-option>
              </mat-select>
              <button
                mat-icon-button
                matSuffix
                (click)="selectedRegion = ''; onRegionChange()"
                class="clear-filter-btn"
                tabindex="-1"
                aria-label="Effacer le filtre région"
                *ngIf="selectedRegion"
              >
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>
          </div>

          <!-- Deuxième ligne : 4 filtres -->
          <div class="filters-content filters-row-2">
            <mat-form-field appearance="outline">
              <mat-label>{{ "USERS.CITY" | translate }}</mat-label>
              <mat-select
                [(ngModel)]="selectedCity"
                (selectionChange)="onCityChange()"
              >
                <mat-option value="">{{ "USERS.ALL_CITIES" | translate }}</mat-option>
                <mat-option *ngFor="let city of availableCities" [value]="city">
                  {{ city }}
                </mat-option>
              </mat-select>
              <button
                mat-icon-button
                matSuffix
                (click)="selectedCity = ''; onCityChange()"
                class="clear-filter-btn"
                tabindex="-1"
                aria-label="Effacer le filtre ville"
                *ngIf="selectedCity"
              >
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ "USERS.STORE" | translate }}</mat-label>
              <mat-select
                [(ngModel)]="selectedStore"
                (selectionChange)="applyFilter()"
              >
                <mat-option value="">{{ "USERS.ALL_STORES" | translate }}</mat-option>
                <mat-option *ngFor="let store of availableStores" [value]="store">
                  {{ store }}
                </mat-option>
              </mat-select>
              <button
                mat-icon-button
                matSuffix
                (click)="selectedStore = ''; applyFilter()"
                class="clear-filter-btn"
                tabindex="-1"
                aria-label="Effacer le filtre magasin"
                *ngIf="selectedStore"
              >
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Marques</mat-label>
              <mat-select
                [(ngModel)]="selectedBrand"
                (selectionChange)="applyFilter()"
              >
                <mat-option value="">Toutes les marques</mat-option>
                <mat-option *ngFor="let brand of availableBrands" [value]="brand">
                  {{ brand }}
                </mat-option>
              </mat-select>
              <button
                mat-icon-button
                matSuffix
                (click)="selectedBrand = ''; applyFilter()"
                class="clear-filter-btn"
                tabindex="-1"
                aria-label="Effacer le filtre marque"
                *ngIf="selectedBrand"
              >
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Enseignes</mat-label>
              <mat-select
                [(ngModel)]="selectedEnseigne"
                (selectionChange)="applyFilter()"
              >
                <mat-option value="">Toutes les enseignes</mat-option>
                <mat-option *ngFor="let enseigne of availableEnseignes" [value]="enseigne">
                  {{ enseigne }}
                </mat-option>
              </mat-select>
              <button
                mat-icon-button
                matSuffix
                (click)="selectedEnseigne = ''; applyFilter()"
                class="clear-filter-btn"
                tabindex="-1"
                aria-label="Effacer le filtre enseigne"
                *ngIf="selectedEnseigne"
              >
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>
          </div>
        </div>

        <table
          mat-table
          [dataSource]="combinedDataSource"
          matSort
          class="mat-elevation-z8 full-table"
        >
          <!-- ID -->
          <!-- <ng-container matColumnDef="numero">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="background-color: #f2f2f2"
            >
              ID
            </th>
            <td mat-cell *matCellDef="let row">{{ row.id }}</td>
          </ng-container> -->

          <!-- Name -->
          <ng-container matColumnDef="nom">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="background-color: #f2f2f2"
            >
              {{ "USERS.FULL_NAME" | translate }}
            </th>
            <td mat-cell *matCellDef="let row">{{ row.nom }}</td>
          </ng-container>

          <!-- Region -->
          <ng-container matColumnDef="region">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="background-color: #f2f2f2"
            >
              {{ "USERS.REGION" | translate }}
            </th>
            <td mat-cell *matCellDef="let row">
              <div
                style="
                  background-color: #f2f2f2;
                  text-align: center;
                  border-radius: 5px;
                  padding: 6px 16px;
                  width: 80%;
                "
              >
                {{ row.region || "—" }}
              </div>
            </td>
          </ng-container>

          <!-- City -->
          <ng-container matColumnDef="city">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="background-color: #f2f2f2"
            >
              {{ "USERS.CITY" | translate }}
            </th>
            <td mat-cell *matCellDef="let row">
              <div
                style="
                  background-color: #f2f2f2;
                  text-align: center;
                  border-radius: 5px;
                  padding: 6px 16px;
                  width: 80%;
                "
              >
                {{ row.ville || "—" }}
              </div>
            </td>
          </ng-container>

          <!-- Store -->
          <ng-container matColumnDef="store">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="background-color: #f2f2f2"
            >
              {{ "USERS.STORE" | translate }}
            </th>
            <td mat-cell *matCellDef="let row">
              <div
                style="
                  background-color: #f2f2f2;
                  text-align: center;
                  border-radius: 5px;
                  padding: 6px 16px;
                  width: 80%;
                "
              >
                {{ row.magasin || "—" }}
              </div>
            </td>
          </ng-container>

          <!-- Marques -->
          <ng-container matColumnDef="marques">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="background-color: #f2f2f2"
            >
              Marques
            </th>
            <td mat-cell *matCellDef="let row">
              <div class="marques-chips">
                <div class="chips-container">
                  <mat-chip-listbox *ngIf="row.marques && row.marques.length > 0; else noMarques">
                    <mat-chip-option *ngFor="let marque of row.marques" >
                      {{ marque }}
                    </mat-chip-option>
                  </mat-chip-listbox>
                  <ng-template #noMarques>
                    <span style="color: #999; font-style: italic;">Aucune marque</span>
                  </ng-template>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Enseignes -->
          <ng-container matColumnDef="enseignes">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="background-color: #f2f2f2"
            >
              Enseignes
            </th>
            <td mat-cell *matCellDef="let row">
              <div >
                <div >
                  <mat-chip-listbox *ngIf="row.enseignes && row.enseignes.length > 0; else noEnseignes">
                    <mat-chip-option *ngFor="let enseigne of row.enseignes"  style="color:#000000">
                      {{ enseigne }}
                    </mat-chip-option>
                  </mat-chip-listbox>
                  <ng-template #noEnseignes>
                    <span style="color: #999; font-style: italic;">Aucune enseigne</span>
                  </ng-template>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Connection -->
          <ng-container matColumnDef="connexion">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="background-color: #f2f2f2"
            >
              {{ "USERS.LAST_LOGIN" | translate }}
            </th>
            <td mat-cell *matCellDef="let row">
              <div
                style="
                  background-color: #f2f2f2;
                  width: 90%;
                  text-align: center;
                  padding: 8px;
                  border-radius: 5px;
                "
              >
                <div *ngIf="row.derniereConnexion && row.derniereConnexion !== '—'" class="login-info">
                  <div style="font-weight: bold; color: #333;">
                    {{ row.derniereConnexion | date:'dd/MM/yyyy HH:mm' }}
                  </div>
                  <div style="font-size: 0.8em; color: #666; margin-top: 2px;">
                    Session: {{ row.derniereSession || 'N/A' }}
                  </div>
                </div>
                <div *ngIf="!row.derniereConnexion || row.derniereConnexion === '—'" style="color: #999;">
                  —
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Sessions -->
          <ng-container matColumnDef="sessions">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="background-color: #f2f2f2"
            >
              {{ "USERS.SESSIONS" | translate }}
            </th>
            <td mat-cell *matCellDef="let row">{{ row.sessions || 0 }}</td>
          </ng-container>

          <!-- Role -->
          <ng-container matColumnDef="role">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="background-color: #f2f2f2"
            >
              {{ "USERS.ROLE" | translate }}
            </th>
            <td mat-cell *matCellDef="let row">
              <div
                style="
                  background-color: #f2f2f2;
                  text-align: center;
                  border-radius: 5px;
                  padding: 6px 16px;
                  width: 80%;
                "
              >
                {{ row.type }}
              </div>
            </td>
          </ng-container>

          <!-- Status -->
          <ng-container matColumnDef="status">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="background-color: #f2f2f2"
            >
              {{ "USERS.STATUS" | translate }}
            </th>
            <td mat-cell *matCellDef="let row">
              <button
                *ngIf="canEdit"
                mat-button
                [ngClass]="
                  row.status === 'ACTIVE' ? 'btn-active' : 'btn-inactive'
                "
                (click)="toggleStatus(row); $event.stopPropagation()"
                [title]="'Status: ' + row.status + ' | Type: ' + row.type"
                [attr.data-status]="row.status"
                [attr.data-class]="
                  row.status === 'ACTIVE' ? 'btn-active' : 'btn-inactive'
                "
              >
                {{ row.status }}
              </button>
              <span *ngIf="!canEdit" [ngClass]="row.status === 'ACTIVE' ? 'status-active' : 'status-inactive'">
                {{ row.status }}
              </span>
            </td>
          </ng-container>

          <!-- Actions -->
          <ng-container matColumnDef="actions">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="background-color: #f2f2f2"
            >
              {{ "USERS.ACTIONS" | translate }}
            </th>
            <td mat-cell *matCellDef="let row" class="action-buttons-cell">
              <div class="action-buttons-container">
                <button
                  *ngIf="canEdit"
                  mat-icon-button
                  (click)="editUser(row); $event.stopPropagation()"
                  title="Modifier"
                >
                  <mat-icon style="color: blue">edit</mat-icon>
                </button>
                <!-- <button 
                  mat-icon-button
                  (click)="showUserDetails(row); $event.stopPropagation()"
                  title="Voir détails"
                >
                  <mat-icon>visibility</mat-icon>
                </button> -->
                <button
                  *ngIf="canDelete"
                  mat-icon-button
                  (click)="deleteUser(row.id, row.type); $event.stopPropagation()"
                  title="Supprimer"
                >
                  <mat-icon style="color: black">delete</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <!-- Row declaration -->
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            (click)="onRowClick($event, row)"
            class="hoverable"
          ></tr>
        </table>

        <mat-paginator
          [pageSize]="5"
          [pageSizeOptions]="[5, 10, 20, 100]"
          showFirstLastButtons
        ></mat-paginator>
      </div>
    </div>
  </div>
</div>

<!-- Overlay pour fermer le panneau en cliquant à l'extérieur -->
<div
  class="panel-overlay"
  [class.visible]="isColumnCustomizationOpen"
  (click)="closeColumnCustomizationPanel()"
></div>

<!-- Panneau de personnalisation des colonnes -->
<app-column-customization-panel
  [isOpen]="isColumnCustomizationOpen"
  [columnConfig]="columnConfig"
  (close)="closeColumnCustomizationPanel()"
  (save)="onColumnCustomizationSave($event)"
></app-column-customization-panel>
