<div class="user-form-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>{{ isEditMode ? 'Modifier l\'utilisateur' : 'Ajouter un nouvel utilisateur' }}</mat-card-title>
    </mat-card-header>

    <mat-card-content class="scrollable-content">
      <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
        <!-- Contenu du formulaire inchangé -->
        <!-- NOM & PRÉNOM -->
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Nom</mat-label>
            <input matInput formControlName="nom" placeholder="Nom" required>
            <mat-error *ngIf="userForm.get('nom')?.hasError('required')">Le nom est obligatoire</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Prénom</mat-label>
            <input matInput formControlName="prenom" placeholder="Prénom" required>
            <mat-error *ngIf="userForm.get('prenom')?.hasError('required')">Le prénom est obligatoire</mat-error>
          </mat-form-field>
        </div>

        <!-- TÉLÉPHONE & EMAIL -->
        <div class="form-row">
          <mat-form-field appearance="outline" class="phone-input">
            <mat-label>Téléphone</mat-label>
            <div matPrefix class="phone-prefix">
              <img src="assets/3840661.webp" alt="MA" class="flag-icon">
              <span>+212</span>
            </div>
            <input matInput type="tel" formControlName="telephone" placeholder="6XXXXXXXX" maxlength="9">
            <mat-error *ngIf="userForm.get('telephone')?.hasError('pattern')">Numéro invalide (ex: 6XXXXXXXX)</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Email</mat-label>
            <input matInput type="email" formControlName="email" placeholder="exemple@email.com" required>
            <mat-error *ngIf="userForm.get('email')?.hasError('required')">L'email est obligatoire</mat-error>
            <mat-error *ngIf="userForm.get('email')?.hasError('email')">Format d'email invalide</mat-error>
          </mat-form-field>
        </div>
        <!-- RÔLE -->
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Rôle</mat-label>
            <mat-select formControlName="role">
              <mat-option *ngFor="let r of Role" [value]="r.value">{{ r.label }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- CHAMPS MERCHANDISEUR -->
        <div *ngIf="isMerchandiseur()">
          <div class="form-row">
      
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Région</mat-label>
              <mat-select formControlName="region">
                <mat-option *ngFor="let region of Region" [value]="region.valueOf()">
                  {{ region }}
                </mat-option>
              </mat-select>
            </mat-form-field>
  
            <!-- Ville dépendante de la région -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Ville</mat-label>
              <mat-select formControlName="ville">
                <mat-option *ngFor="let ville of villesDisponibles" [value]="ville">
                  {{ ville }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Marques couvertes</mat-label>
              <mat-select formControlName="marques" multiple>
                <mat-option *ngFor="let marque of marques" [value]="marque">{{ marque }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Sous-marque (facultatif)</mat-label>
              <input matInput formControlName="sousMarque" placeholder="Sous-marque">
            </mat-form-field>
          </div>
          <div class="form-row">
           <mat-form-field appearance="outline" class="full-width">
                <mat-label>Profil</mat-label>
                <mat-select formControlName="type">
                  <mat-option *ngFor="let r of Type" [value]="r.value">{{ r.label }}</mat-option>
                </mat-select>
              </mat-form-field>
              </div>
        </div>

        <!-- CHAMPS SUPERVISEUR -->
        <div *ngIf="isSuperviseur()">
          <div class="form-row">

      
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Région</mat-label>
              <mat-select formControlName="region">
                <mat-option *ngFor="let region of Region" [value]="region.valueOf()">
                  {{ region }}
                </mat-option>
              </mat-select>
            </mat-form-field>
  
            <!-- Ville dépendante de la région -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Ville</mat-label>
              <mat-select formControlName="ville">
                <mat-option *ngFor="let ville of villesDisponibles" [value]="ville">
                  {{ ville }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Merchandiseurs</mat-label>
              <mat-select formControlName="merchandiseurs" multiple>
                <mat-option *ngFor="let merch of merchendiseurs" [value]="merch">
                  {{ merch.nom }} {{ merch.prenom }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <!-- BOUTONS -->
        <div class="form-actions">
          <button mat-raised-button color="primary" type="submit">
            {{ isEditMode ? 'Modifier' : 'Ajouter' }}
          </button>
          <button mat-button type="button" (click)="onCancel()" class="cancel-button">Annuler</button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>