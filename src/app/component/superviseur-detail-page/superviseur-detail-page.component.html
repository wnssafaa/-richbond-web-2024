<!-- Header principal -->
<div class="header">
  <img src="assets/logo.png" alt="Richbond Logo" class="logo" />
  <div class="header-icons">
    <mat-icon>notifications_none</mat-icon>
    
    <!-- Bouton de changement de langue -->
    <button mat-button [matMenuTriggerFor]="languageMenu" class="lang-button">
      <img [src]="'assets/' + (currentLanguage === 'fr' ? 'OIP.webp' : 'usa.png')" 
           alt="Language" 
           class="lang-icon" />
      <span>{{ currentLanguage | uppercase }}</span>
      <mat-icon>arrow_drop_down</mat-icon>
    </button>
    
    <mat-menu #languageMenu="matMenu">
      <button mat-menu-item (click)="changeLanguage('fr')">
        <img src="assets/OIP.webp" alt="Français" class="lang-option-icon">
        <span>FR</span>
      </button>
      <button mat-menu-item (click)="changeLanguage('en')">
        <img src="assets/usa.png" alt="English" class="lang-option-icon">
        <span>EN</span>
      </button>
    </mat-menu>
    
    <mat-icon>settings</mat-icon>
  </div>
</div>

<div class="container">
  <div class="example-container">
    <!-- Sidebar Navigation -->
    <div class="sidebar" [class.sidebar-collapsed]="!menuOpen">
      <div class="user-profile" [class.user-profile-collapsed]="!menuOpen">
        <img 
          [src]="avatarUrl" 
          alt="Avatar" 
          width="100" 
          height="100" 
          style="border-radius:50%;" />
        <div class="user-info" [class.user-info-hidden]="!menuOpen">
          <strong>{{ username }}</strong>
          <p>{{ role }}</p>
        </div>
      </div>

      <mat-nav-list [class.nav-list-collapsed]="!menuOpen">
        <a mat-list-item routerLink="/Dashbord" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen" 
           [matTooltip]="!menuOpen ? ('COMMON.DASHBOARD' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>dashboard</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.DASHBOARD' | translate }}</span>
        </a>
        
        <a mat-list-item routerLink="/users" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? 'Tous les utilisateurs' : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>group</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">Tous les utilisateurs</span>
        </a>
        
        <a mat-list-item routerLink="/merchendiseur" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.MERCHANDISERS' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>storefront</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.MERCHANDISERS' | translate }}</span>
        </a>
        
        <a mat-list-item routerLink="/superviseur" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.SUPERVISORS' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>supervisor_account</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.SUPERVISORS' | translate }}</span>
        </a>
        
        <a mat-list-item routerLink="/magasins" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.STORES' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>store</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.STORES' | translate }}</span>
        </a>
        
        <a mat-list-item routerLink="/planification" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.PLANNING' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>event_note</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.PLANNING' | translate }}</span>
        </a>
        
        <a mat-list-item routerLink="/gestion-visites" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.VISIT' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>location_on</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.VISIT' | translate}}</span>
        </a>

        <a mat-list-item routerLink="/Produit" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.PRODUCTS' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>inventory</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.PRODUCTS' | translate }}</span>
        </a>
        
        <a mat-list-item routerLink="/parametre" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.SETTINGS' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>settings</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.SETTINGS' | translate }}</span>
        </a>

        <a mat-list-item routerLink="/help" routerLinkActive="active-link" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('COMMON.HELP' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon>help_outline</mat-icon>
          <span matListItemTitle [class.text-hidden]="!menuOpen">{{ 'COMMON.HELP' | translate }}</span>
        </a>
        
        <a mat-list-item (click)="openLogoutDialog()" [class.nav-item-collapsed]="!menuOpen"
           [matTooltip]="!menuOpen ? ('AUTH.LOGOUT' | translate) : ''" matTooltipPosition="right">
          <mat-icon matListItemIcon style="color: #ff0022;">logout</mat-icon>
          <span matListItemTitle style="color: #ff0022;" [class.text-hidden]="!menuOpen">{{ 'AUTH.LOGOUT' | translate }}</span>
        </a>
      </mat-nav-list>
    </div>

    <div class="content">
      <!-- Page header avec navigation -->
      <div class="page-header">
        <div class="page-header-left">
          <button mat-icon-button (click)="toggleMenu()" class="menu-toggle">
            <mat-icon *ngIf="!menuOpen" style="color: #333;margin-bottom: 15px;">keyboard_arrow_left</mat-icon>
            <mat-icon *ngIf="menuOpen" style="color: #333;margin-bottom: 15px;">keyboard_arrow_right</mat-icon>
          </button>
          <h1 (click)="goBack()">
            Détail du Superviseur
          </h1>
        </div>
      </div>

      <!-- Contenu principal -->
      <div class="all" style="background:white">
        <!-- Superviseur details -->
        <div *ngIf="superviseur && !loading" class="superviseur-detail-container" style="background:white">
          <!-- Carte de détail du superviseur -->
          <div class="superviseur-detail-card" style="background:white">
            <!-- Header du superviseur -->
            <div class="superviseur-header">
               <div class="profile-header">
                <div class="profile-picture-section">
                  <div class="profile-picture-container">
                    <img [src]="getSuperviseurImageUrl()" 
                         *ngIf="superviseur.imagePath; else noImage"
                         class="profile-picture"
                         (error)="onImageError($event)">
                    <ng-template #noImage>
                      <div class="no-image-placeholder">
                        <mat-icon>person</mat-icon>
                      </div>
                    </ng-template>
                  </div>
                </div>
                
                <div class="profile-info">
                  <h1 class="profile-name">{{ superviseur.nom }} {{ superviseur.prenom }}</h1>
                  <p class="profile-email">{{ superviseur.email || 'Email non spécifié' }}</p>
                </div>
                
               
              </div>
              <div class="footer-actions">
                     <button mat-raised-button class="export-button" (click)="goBack()" > 
      <span>Retour</span>
      <mat-icon>arrow_back</mat-icon>
    </button>
                <button
                  mat-raised-button
                  class="add-user-button"
                  style="background-color: #0A2681; color: white;"
                  (click)="editSuperviseur()"
                  *ngIf="superviseur"
                >
                  Modifier le superviseur
                </button>
              </div>
            </div>

            <!-- Contenu du superviseur -->
            <div class="superviseur-content" style="background:white;margin-bottom:30%;">
              <!-- Section Profile Header -->
            

              <!-- Section Informations -->
              <div class="info-section">
                <div class="info-grid">
                  <div class="info-row">
                    <div class="info-field">
                      <label class="field-label">Nom complet</label>
                      <div class="field-value">{{ superviseur.nom }} {{ superviseur.prenom }}</div>
                    </div>
                    
                    <div class="info-field">
                      <label class="field-label">Région</label>
                      <div class="field-value">{{ superviseur.region || 'Non spécifiée' }}</div>
                    </div>
                  </div>

                  <div class="info-row">
                    <div class="info-field">
                      <label class="field-label">Téléphone</label>
                      <div class="field-value">{{ superviseur.telephone || 'Non spécifié' }}</div>
                    </div>
                    
                    <div class="info-field">
                      <label class="field-label">Ville</label>
                      <div class="field-value">{{ superviseur.ville || 'Non spécifiée' }}</div>
                    </div>
                  </div>

                  <!-- <div class="info-row">
                    <div class="info-field">
                      <label class="field-label">Magasin</label>
                      <div class="field-value">{{ superviseur.magasin || 'Non spécifié' }}</div>
                    </div>
                    
                    <div class="info-field">
                      <label class="field-label">Statut</label>
                      <div class="field-value status-badge" [class]="'status-' + (superviseur.status?.toLowerCase() || 'inactive')">
                        {{ superviseur.status || 'Non spécifié' }}
                      </div>
                    </div>
                  </div>

                  <div class="info-row">
                    <div class="info-field">
                      <label class="field-label">Marques Couvertes</label>
                      <div class="field-value">{{ superviseur.marquesCouvertes || 'Non spécifiées' }}</div>
                    </div>
                    
                    <div class="info-field">
                      <label class="field-label">Merchandiseurs</label>
                      <div class="field-value">{{ getMerchandiseurNames(superviseur.merchendiseurs) }}</div>
                    </div>
                  </div>

                   <div class="info-row">
                     <div class="info-field">
                       <label class="field-label">Date d'Intégration</label>
                       <div class="field-value">{{ superviseur.dateIntegration || 'Non spécifiée' | date:'shortDate' }}</div>
                     </div>
                     
                     <div class="info-field">
                       <label class="field-label">Date de Sortie</label>
                       <div class="field-value">{{ superviseur.dateSortie || 'Non spécifiée' | date:'shortDate' }}</div>
                     </div>
                   </div> -->
                 </div>
               </div>

               <!-- Section Merchandiseurs -->
               <div class="merchandiseurs-section" *ngIf="merchandiseurs && merchandiseurs.length > 0">
                 <div class="section-title">
                   <mat-icon class="section-icon">group</mat-icon>
                   <span>Merchandiseurs Assignés ({{ merchandiseurs.length }})</span>
                 </div>
                 
                 <div class="merchandiseurs-grid">
                   <div class="merchandiseur-card" *ngFor="let merch of merchandiseurs">
                     <div class="merchandiseur-header">
                       <div class="merchandiseur-avatar">
                         <img [src]="getMerchandiseurImageUrl(merch)" 
                              *ngIf="merch.imagePath; else noMerchImage"
                              class="merchandiseur-image"
                              (error)="onMerchandiseurImageError($event)">
                         <ng-template #noMerchImage>
                           <div class="no-merch-image-placeholder">
                             <mat-icon>person</mat-icon>
                           </div>
                         </ng-template>
                       </div>
                       
                       <div class="merchandiseur-info">
                         <h3 class="merchandiseur-name">{{ merch.nom }} {{ merch.prenom }}</h3>
                         <p class="merchandiseur-email">{{ merch.email || 'Email non spécifié' }}</p>
                         <span class="merchandiseur-status" [class]="'status-' + (merch.status.toLowerCase() || 'inactive')">
                           {{ merch.status || 'Non spécifié' }}
                         </span>
                       </div>
                     </div>
                     
                     <div class="merchandiseur-details">
                       <div class="detail-row">
                         <div class="detail-field">
                           <label class="detail-label">Téléphone</label>
                           <div class="detail-value">{{ merch.telephone || 'Non spécifié' }}</div>
                         </div>
                         <div class="detail-field">
                           <label class="detail-label">Ville</label>
                           <div class="detail-value">{{ merch.ville || 'Non spécifiée' }}</div>
                         </div>
                       </div>
                       
                       <div class="detail-row">
                         <div class="detail-field full-width">
                           <label class="detail-label">Région</label>
                           <div class="detail-value">{{ merch.region || 'Non spécifiée' }}</div>
                         </div>
                      
                       </div>
                       
                       <div class="detail-row">
                         <div class="detail-field full-width">
                           <label class="detail-label">Marques Couvertes</label>
                           <div class="detail-value">{{ merch.marqueCouverte || 'Non spécifiées' }}</div>
                         </div>
                       </div>
                       
                       <div class="detail-row" *ngIf="merch.enseignes && merch.enseignes.length > 0">
                         <div class="detail-field full-width">
                           <label class="detail-label">Enseignes</label>
                           <div class="detail-value">{{ merch.enseignes.join(', ') }}</div>
                         </div>
                       </div>
                       
                       <!-- <div class="detail-row" *ngIf="merch.dateDebutIntegration || merch.dateSortie">
                         <div class="detail-field">
                           <label class="detail-label">Date d'Intégration</label>
                           <div class="detail-value">{{ merch.dateDebutIntegration || 'Non spécifiée' | date:'shortDate' }}</div>
                         </div>
                         <div class="detail-field">
                           <label class="detail-label">Date de Sortie</label>
                           <div class="detail-value">{{ merch.dateSortie || 'Non spécifiée' | date:'shortDate' }}</div>
                         </div>
                       </div> -->
                     </div>
                   </div>
                 </div>
               </div>

               <!-- Message si aucun merchandiseur -->
               <div class="no-merchandiseurs" *ngIf="!merchandiseurs || merchandiseurs.length === 0">
                 <div class="no-merchandiseurs-content">
                   <mat-icon class="no-merchandiseurs-icon">group_off</mat-icon>
                   <h3>Aucun merchandiseur assigné</h3>
                   <p>Ce superviseur n'a actuellement aucun merchandiseur sous sa responsabilité.</p>
                 </div>
               </div>
             </div>
           </div>
         </div>

        <!-- États de chargement et d'erreur -->
        <div *ngIf="loading" class="loading-container">
          <mat-spinner></mat-spinner>
          <p>Chargement des détails du superviseur...</p>
        </div>

        <div *ngIf="error" class="error-container">
          <mat-icon class="error-icon">error</mat-icon>
          <h3>Erreur</h3>
          <p>{{ error }}</p>
          <button mat-raised-button color="primary" (click)="goBack()">
            Retour à la liste
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
