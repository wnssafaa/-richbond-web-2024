<div class="import-dialog-container">
  <h2 mat-dialog-title>
    <mat-icon>upload_file</mat-icon>
    Importer des Merchandiseurs
  </h2>

  <mat-dialog-content>
    <!-- Section de sélection de fichier -->
    <div class="file-upload-section" *ngIf="importedData.length === 0">
      <div class="upload-area">
        <mat-icon class="upload-icon">cloud_upload</mat-icon>
        <h3>Glissez-déposez votre fichier ici</h3>
        <p>ou</p>
        <input 
          type="file" 
          #fileInput 
          (change)="onFileSelected($event)" 
          accept=".xlsx,.xls,.csv"
          style="display: none;">
        <button mat-raised-button color="primary" (click)="fileInput.click()">
          <mat-icon>folder_open</mat-icon>
          Sélectionner un fichier
        </button>
        <p class="file-info">Formats acceptés : Excel (.xlsx, .xls) ou CSV (.csv)</p>
      </div>

      <div class="template-section">
        <mat-icon>info</mat-icon>
        <p>Besoin d'un modèle ? Téléchargez le template Excel</p>
        <button mat-stroked-button color="accent" (click)="downloadTemplate()">
          <mat-icon>download</mat-icon>
          Télécharger le Template
        </button>
      </div>
    </div>

    <!-- Barre de progression -->
    <mat-progress-bar 
      *ngIf="isLoading" 
      mode="indeterminate" 
      color="primary">
    </mat-progress-bar>

    <!-- Section de prévisualisation -->
    <div class="preview-section" *ngIf="importedData.length > 0 && !isLoading">
      <div class="preview-header">
        <h3>Prévisualisation des données</h3>
        <div class="stats">
          <span class="stat-valid">
            <mat-icon>check_circle</mat-icon>
            {{ validCount }} valides
          </span>
          <span class="stat-invalid">
            <mat-icon>error</mat-icon>
            {{ invalidCount }} invalides
          </span>
        </div>
      </div>

      <div class="table-container">
        <table mat-table [dataSource]="importedData" class="import-table">
          <!-- Colonne Prénom -->
          <ng-container matColumnDef="prenom">
            <th mat-header-cell *matHeaderCellDef>Prénom</th>
            <td mat-cell *matCellDef="let element">{{ element.prenom }}</td>
          </ng-container>

          <!-- Colonne Nom -->
          <ng-container matColumnDef="nom">
            <th mat-header-cell *matHeaderCellDef>Nom</th>
            <td mat-cell *matCellDef="let element">{{ element.nom }}</td>
          </ng-container>

          <!-- Colonne Email -->
          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef>Email</th>
            <td mat-cell *matCellDef="let element">{{ element.email }}</td>
          </ng-container>

          <!-- Colonne Téléphone -->
          <ng-container matColumnDef="telephone">
            <th mat-header-cell *matHeaderCellDef>Téléphone</th>
            <td mat-cell *matCellDef="let element">{{ element.telephone }}</td>
          </ng-container>

          <!-- Colonne Région -->
          <ng-container matColumnDef="region">
            <th mat-header-cell *matHeaderCellDef>Région</th>
            <td mat-cell *matCellDef="let element">{{ element.region }}</td>
          </ng-container>

          <!-- Colonne Ville -->
          <ng-container matColumnDef="ville">
            <th mat-header-cell *matHeaderCellDef>Ville</th>
            <td mat-cell *matCellDef="let element">{{ element.ville }}</td>
          </ng-container>

          <!-- Colonne Statut -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Statut</th>
            <td mat-cell *matCellDef="let element">
              <span 
                class="status-badge" 
                [class.valid]="element.valid" 
                [class.invalid]="!element.valid">
                {{ element.valid ? 'Valide' : 'Invalide' }}
              </span>
            </td>
          </ng-container>

          <!-- Colonne Erreurs -->
          <ng-container matColumnDef="errors">
            <th mat-header-cell *matHeaderCellDef>Erreurs</th>
            <td mat-cell *matCellDef="let element">
              <span *ngIf="element.errors && element.errors.length > 0" class="errors-list">
                {{ element.errors.join(', ') }}
              </span>
              <mat-icon *ngIf="element.valid" color="primary">check</mat-icon>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr 
            mat-row 
            *matRowDef="let row; columns: displayedColumns;"
            [class.invalid-row]="!row.valid">
          </tr>
        </table>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()">
      <mat-icon>close</mat-icon>
      Annuler
    </button>

    <button 
      mat-raised-button 
      color="primary" 
      (click)="onImport()" 
      [disabled]="validCount === 0 || isLoading"
      *ngIf="importedData.length > 0">
      <mat-icon>upload</mat-icon>
      Importer {{ validCount }} merchandiseur(s)
    </button>
  </mat-dialog-actions>
</div>

